<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Family Tree View-Only</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background:#f0f0f0; }
svg { width:100vw; height:100vh; background:#fafafa; }
.person-box { fill:white; stroke-width:2; rx:8; ry:8; cursor:pointer; }
.male { stroke:#2b6cb0; }
.female { stroke:#c53030; }
.unknown { stroke:#555; }
.person-text { font-size:13px; text-anchor:middle; dominant-baseline:middle; pointer-events:none; }
.link { stroke:#666; stroke-width:2; fill:none; }
#bioTooltip { position:absolute; background:#fff; border:1px solid #ccc; padding:10px; max-width:250px; display:none; box-shadow:0 2px 8px rgba(0,0,0,0.2); z-index:1000; }
#bioTooltip img { max-width:100%; max-height:150px; width:auto; height:auto; display:block; margin-bottom:6px; object-fit:contain; }
#profileModal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; z-index:2000; overflow-y:auto; }
#profileModal .modal-content { background:#fff; max-width:1200px; margin:50px auto; padding:20px; border-radius:8px; box-shadow:0 4px 16px rgba(0,0,0,0.3); }
#profileModal .header { border-bottom:1px solid #a2a9b1; padding-bottom:10px; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center; }
#profileModal .header h1 { margin:0; font-size:28px; font-family:'Linux Libertine',Georgia,Times,serif; }
#profileModal .close-btn { background:#e9ecef; border:1px solid #a2a9b1; padding:8px 16px; cursor:pointer; border-radius:4px; }
#profileModal .close-btn:hover { background:#dee2e6; }
#profileModal #profileContent {
  display: grid;
  grid-template-columns: 1fr 300px;
  gap: 20px;
}

#profileModal .text-column {
  grid-column: 1 / 2;
}

#profileModal .image-column {
  grid-column: 2 / 3;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

#profileModal .wiki-image {
  float: none;
  max-width: 100%;
}
@media (max-width: 800px) {
  #profileModal #profileContent {
    grid-template-columns: 1fr;
  }
  #profileModal .image-column {
    order: -1;
  }
}

#profileModal .wiki-image img { width:100%; display:block; }
#profileModal .wiki-image-caption { padding:5px; font-size:13px; text-align:left; }
#profileModal .wiki-image.small { max-width:120px; }
#profileModal .wiki-image.medium { max-width:200px; }
#profileModal .wiki-image.large { max-width:300px; }
#profileModal #profileContent { font-family:sans-serif; font-size:14px; line-height:1.6; }
#profileModal #profileContent a { color:#0645ad; text-decoration:underline; cursor:pointer; }
#profileModal #profileContent a:hover { color:#0b0080; }
</style>
</head>
<body>
<svg id="tree"></svg>
<div id="bioTooltip"></div>
<div id="profileModal">
  <div class="modal-content">
    <div class="header">
      <h1 id="modalTitle">Person Profile</h1>
      <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
    <div id="profileContent"></div>
  </div>
</div>
<script>
const data = {
  "people": [
    {
      "id": "p1",
      "name": "Lauronce Jabbour",
      "gender": "female",
      "parents": [],
      "partners": [],
      "children": [
        "p1768698521639",
        "p1768698544953"
      ],
      "bio": "1938 - ",
      "images": [
        "images/image_0.jpeg"
      ],
      "profileContent": "<div class=\"text-column\" contenteditable=\"true\"><p>Lauronce Jabbour was born in Ain El Jdideh in Lebanon in 1938 to Khalil Jabbour and Adel Kenaan Al Khoury. Although she enjoyed school, her father took her out of school at an early age to learn a trade and get married. She became a seamstress and married Simon Khachan in 1957. They eloped due to the disapproval of the match by her father. She had two children, Joseph (1961) and Noha (1958). Simon emigrated to Sydney Australia in 1963 and established himself there with employment and the purchase of a house at 3 Arthur Street Croydon, Sydney. Lauronce and her two children followed Simon to Australia in 1968.&nbsp;</p></div><div class=\"image-column\"><div class=\"wiki-image medium\" contenteditable=\"false\"><img src=\"images/image_0.jpeg\" alt=\"Lauronce Jabbour shortly after her married to Simon Khachan in 1957.\"><div class=\"wiki-image-caption\" contenteditable=\"true\" style=\"cursor: text;\">Lauronce Jabbour shortly after her married to Simon Khachan in 1957.</div></div><div class=\"wiki-image\" contenteditable=\"false\"><img src=\"images/image_1.jpeg\" alt=\"Lauronce and Husband Simon in 1957\"><div class=\"wiki-image-caption\" contenteditable=\"true\" style=\"cursor: text;\">Lauronce and Husband Simon in 1957</div></div></div>"
    },
    {
      "id": "p1768698521639",
      "name": "Joseph Khachan",
      "gender": "male",
      "parents": [
        "p1",
        "p1768698592333"
      ],
      "partners": [],
      "children": [],
      "bio": "1961 - ",
      "images": [
        "images/image_2.jpeg"
      ],
      "profileContent": "<div class=\"text-column\" contenteditable=\"true\"><p>Joe (Zouzou) Khachan was born in Lebanon on Sunday 2 July 1961 in Beirut. However, his official date of birth is recorded as 2 February 1962 because in Lebanon at the time you had to register your child or you will be fined. They did not register him immediately and so had to change the date of birth to a later one so they will not be fined. His father was Simon Gergis Khachan and his mother is Lauronce Khalil Jabbour. His sister is Noha Elazar (nee Khachan) who married Karim Elazar.&nbsp;</p><p>He majored in physics at the University of New South Wales where he obtained both an honours degree and a PhD in physics. His PhD topic was in quantum mechanics. He worked in plasma physics at the University of Sydney for most of his career publishing many <a href=\"https://scholar.google.com/citations?user=ODyc1XoAAAAJ&amp;hl=en\">books and research papers.</a></p><p><br></p><p><br></p><p>&nbsp;</p></div><div class=\"image-column\"><div class=\"wiki-image\" contenteditable=\"false\"><img src=\"images/image_2.jpeg\" alt=\"Image taken at his Breakfast Point unit in front of his bookcase.\"><div class=\"wiki-image-caption\" contenteditable=\"true\" style=\"cursor: text;\">Image taken at his Breakfast Point unit in front of his bookcase.</div></div><div class=\"wiki-image selected\" contenteditable=\"false\"><img src=\"images/image_3.jpeg\" alt=\"Joe behind a machine that he made, which makes crystalline diamond from a plasma. The photo was taken around 1992.\"><div class=\"wiki-image-caption\" contenteditable=\"true\" style=\"cursor: text;\">Joe behind a machine that he made, which makes crystalline diamond from a plasma. The photo was taken around 1992.</div></div></div>"
    },
    {
      "id": "p1768698544953",
      "name": "Noha Khachan",
      "gender": "female",
      "parents": [
        "p1",
        "p1768698592333"
      ],
      "partners": [],
      "children": [
        "p1768700169673",
        "p1768700166825"
      ],
      "bio": "1958 - ",
      "images": [
        "images/image_4.jpeg"
      ],
      "profileContent": "<div class=\"text-column\" contenteditable=\"true\"><p>Noha was born in Lebanon on 5 April 1958 to Simon and Lauronce Khachan (nee Jabbour). She moved to Australia in 1968 with her brother Joseph and mother. She graduated in civil engineering from the University of New South Wales. She married Karim Elazar and had two daughters, Nicole and Stephanie.&nbsp;</p></div><div class=\"image-column\"><div class=\"wiki-image\" contenteditable=\"false\"><img src=\"images/image_5.jpeg\" alt=\"Noha with Karim and Nicole\"><div class=\"wiki-image-caption\">Noha with Karim and Nicole</div></div><div class=\"wiki-image\" contenteditable=\"false\"><img src=\"images/image_6.jpeg\" alt=\"Noha with Karim, Nicole and Stephanie on Stephanie's graduation day with an aviation degree from the University of New South Wales.\"><div class=\"wiki-image-caption\">Noha with Karim, Nicole and Stephanie on Stephanie's graduation day with an aviation degree from the University of New South Wales.</div></div></div>"
    },
    {
      "id": "p1768698592333",
      "name": "Simon Khachan",
      "gender": "male",
      "parents": [],
      "partners": [],
      "children": [
        "p1768698521639",
        "p1768698544953"
      ],
      "bio": "1935 - 2022",
      "images": [
        "images/image_7.jpeg"
      ],
      "profileContent": ""
    },
    {
      "id": "p1768700124133",
      "name": "Karim Elazar",
      "gender": "male",
      "parents": [],
      "partners": [],
      "children": [
        "p1768700169673",
        "p1768700166825"
      ],
      "bio": "",
      "images": [],
      "profileContent": ""
    },
    {
      "id": "p1768700166825",
      "name": "Stephanie Elazar",
      "gender": "female",
      "parents": [
        "p1768698544953",
        "p1768700124133"
      ],
      "partners": [],
      "children": [
        "p1768700276682",
        "p1768700303598"
      ],
      "bio": "1990 -",
      "images": [],
      "profileContent": "<div class=\"text-column\" contenteditable=\"true\"><p>Stephanie was born in 29 June 1990 in Sydney Australia to Karim Elazar and Noha Elazar (nee Khachan). She has a sister, Nicole Elazar. Stephanie graduated in aviation from the University of New South Wales and moved to <a href=\"https://en.wikipedia.org/wiki/Kununurra,_Western_Australia\">Kununurra, Western Australia</a>&nbsp;where she married John Drysdale.</p></div><div class=\"image-column\"></div>"
    },
    {
      "id": "p1768700169673",
      "name": "Nicole Elazar",
      "gender": "female",
      "parents": [
        "p1768698544953",
        "p1768700124133"
      ],
      "partners": [],
      "children": [],
      "bio": "",
      "images": [],
      "profileContent": "<div class=\"text-column\" contenteditable=\"true\"><p>Nicole was born in Sydney Australia in 1987 to Karim and Noha Elazar. She has one sister, Stephanie Drysdale (nee Elazar).&nbsp; She studied ballet, and graduated from the University of New South Wales in media productions.&nbsp;</p></div><div class=\"image-column\"></div>"
    },
    {
      "id": "p1768700244999",
      "name": "John Drysdale",
      "gender": "male",
      "parents": [],
      "partners": [],
      "children": [
        "p1768700276682",
        "p1768700303598"
      ],
      "bio": "",
      "images": [],
      "profileContent": ""
    },
    {
      "id": "p1768700276682",
      "name": "Caitlin Drysdale",
      "gender": "female",
      "parents": [
        "p1768700166825",
        "p1768700244999"
      ],
      "partners": [],
      "children": [],
      "bio": "",
      "images": [],
      "profileContent": ""
    },
    {
      "id": "p1768700303598",
      "name": "Emily Drysdale",
      "gender": "female",
      "parents": [
        "p1768700166825",
        "p1768700244999"
      ],
      "partners": [],
      "children": [],
      "bio": "",
      "images": [],
      "profileContent": ""
    }
  ],
  "positions": {
    "g1": {
      "x": 594,
      "y": -117
    },
    "g2": {
      "x": 810,
      "y": 39
    },
    "p1": {
      "x": 856,
      "y": -5
    },
    "p2": {
      "x": 810,
      "y": 160
    },
    "c1": {
      "x": 710,
      "y": 280
    },
    "p1768697492557": {
      "x": 218,
      "y": 184
    },
    "p1768697497262": {
      "x": -186,
      "y": 8
    },
    "p1768697500814": {
      "x": 105,
      "y": 5
    },
    "p1768697507967": {
      "x": 368,
      "y": 0
    },
    "p1768697513183": {
      "x": 1074,
      "y": 180
    },
    "p1768697749819": {
      "x": 197,
      "y": 184
    },
    "p1768697851445": {
      "x": 766,
      "y": -115
    },
    "p1768697875550": {
      "x": -439,
      "y": 11
    },
    "p1768697895488": {
      "x": 603,
      "y": 5
    },
    "p1768698197708": {
      "x": 1345,
      "y": -117
    },
    "p1768698232983": {
      "x": 1505,
      "y": -116
    },
    "p1768698270769": {
      "x": 1094,
      "y": 192
    },
    "p1768698289187": {
      "x": 1266,
      "y": 21
    },
    "p1768698310029": {
      "x": 1440,
      "y": 20
    },
    "p1768698337023": {
      "x": 1649,
      "y": 12
    },
    "p1768698409750": {
      "x": 1828,
      "y": 10
    },
    "p1768698521639": {
      "x": 794,
      "y": 102
    },
    "p1768698544953": {
      "x": 965,
      "y": 98
    },
    "p1768698592333": {
      "x": 1023,
      "y": -4
    },
    "p1768700124133": {
      "x": 1140,
      "y": 100
    },
    "p1768700166825": {
      "x": 1030,
      "y": 207
    },
    "p1768700169673": {
      "x": 848,
      "y": 205
    },
    "p1768700244999": {
      "x": 1221,
      "y": 202
    },
    "p1768700276682": {
      "x": 1025,
      "y": 301
    },
    "p1768700303598": {
      "x": 1194,
      "y": 300
    },
    "p1768700419150": {
      "x": 2048,
      "y": -7
    },
    "p1768700442913": {
      "x": 2212,
      "y": -6
    },
    "p1768700484302": {
      "x": 1361,
      "y": 110
    },
    "p1768700536308": {
      "x": 1530,
      "y": 106
    },
    "p1768700543748": {
      "x": 1712,
      "y": 108
    },
    "p1768700608363": {
      "x": 1885,
      "y": 110
    },
    "p1769116921584": {
      "x": 396.5,
      "y": -228
    },
    "p1769116926313": {
      "x": 560.5,
      "y": -228
    },
    "p1769117080579": {
      "x": 1049.5,
      "y": -230
    },
    "p1769117175388": {
      "x": 878.5,
      "y": -231
    }
  },
  "pan": {
    "x": -410,
    "y": 207
  }
};
const people = data.people || data;
const personMap = Object.fromEntries(people.map(p => [p.id,p]));
const savedPositions = data.positions || {};
let panX = (data.pan && data.pan.x) || 0;
let panY = (data.pan && data.pan.y) || 0;
let isPanning = false;
let panStartX = 0;
let panStartY = 0;
const svg = document.getElementById('tree');
const bioTooltip = document.getElementById('bioTooltip');
const profileModal = document.getElementById('profileModal');
const modalTitle = document.getElementById('modalTitle');
const profileContent = document.getElementById('profileContent');
const BOX_WIDTH=150, BOX_HEIGHT=40, H_SPACING=50, V_SPACING=120;
const positions={};

function closeModal() {
  profileModal.style.display = 'none';
}

function showProfile(person) {
  modalTitle.textContent = person.name;
  if(person.profileContent && person.profileContent.trim()) {
    profileContent.innerHTML = person.profileContent;
    profileContent.querySelectorAll('[contenteditable]').forEach(el => {
      el.removeAttribute('contenteditable');
    });
  } else {
    let html = '<p><strong>Bio:</strong> ' + (person.bio || 'No bio available.') + '</p>';
    if(person.images && person.images.length > 0) {
      html += '<div style="margin-top:20px;">';
      person.images.forEach(imgSrc => {
        html += `<img src="${imgSrc}" style="max-width:300px; margin:10px; border:1px solid #ccc;">`;
      });
      html += '</div>';
    }
    profileContent.innerHTML = html;
  }
  profileModal.style.display = 'block';
}

profileModal.addEventListener('click', (e) => {
  if(e.target === profileModal) closeModal();
});

function getGeneration(id,cache={}) {
  if(cache[id]!==undefined) return cache[id];
  const p = personMap[id];
  if(!p.parents.length){ cache[id]=0; return 0; }
  cache[id] = Math.max(...p.parents.map(pid => getGeneration(pid,cache)))+1;
  return cache[id];
}

function computePositions() {
  const gens={};
  people.forEach(p => {
    if(savedPositions[p.id]) {
      positions[p.id] = savedPositions[p.id];
    } else if(!positions[p.id]) {
      const g = getGeneration(p.id);
      (gens[g]=gens[g]||[]).push(p.id);
    }
  });
  Object.keys(gens).forEach(gen=>{
    const ids = gens[gen];
    const totalWidth = ids.length*BOX_WIDTH + (ids.length-1)*H_SPACING;
    const startX = (window.innerWidth - totalWidth)/2;
    ids.forEach((id,i)=>{
      positions[id]={ x: startX + i*(BOX_WIDTH+H_SPACING), y: gen*V_SPACING + 40 };
    });
  });
}

function drawLinks() {
  function line(x1,y1,x2,y2){ 
    const l=document.createElementNS("http://www.w3.org/2000/svg","line"); 
    l.setAttribute("x1",x1 + panX); 
    l.setAttribute("y1",y1 + panY); 
    l.setAttribute("x2",x2 + panX); 
    l.setAttribute("y2",y2 + panY); 
    l.setAttribute("class","link"); 
    svg.appendChild(l);
  }
  
  const parentSetMap = new Map();
  
  people.forEach(child => {
    if (!child.parents.length) return;
    
    const parentKey = [...child.parents].sort().join(',');
    
    if (!parentSetMap.has(parentKey)) {
      parentSetMap.set(parentKey, []);
    }
    parentSetMap.get(parentKey).push(child.id);
  });
  
  parentSetMap.forEach((childrenIds, parentKey) => {
    const parentIds = parentKey.split(',');
    const parents = parentIds.map(pid => positions[pid]);
    const children = childrenIds.map(cid => positions[cid]);
    
    const parentMinX = Math.min(...parents.map(p => p.x + BOX_WIDTH/2));
    const parentMaxX = Math.max(...parents.map(p => p.x + BOX_WIDTH/2));
    const parentY = Math.min(...parents.map(p => p.y + BOX_HEIGHT));
    const parentMidY = parentY + 20;
    
    if (parents.length > 1) {
      line(parentMinX, parentMidY, parentMaxX, parentMidY);
    }
    
    parents.forEach(p => {
      line(p.x + BOX_WIDTH/2, p.y + BOX_HEIGHT, p.x + BOX_WIDTH/2, parentMidY);
    });
    
    const parentCenterX = (parentMinX + parentMaxX) / 2;
    
    const childMinX = Math.min(...children.map(c => c.x + BOX_WIDTH/2));
    const childMaxX = Math.max(...children.map(c => c.x + BOX_WIDTH/2));
    const childY = Math.min(...children.map(c => c.y));
    const childMidY = childY - 20;
    
    if (children.length > 1) {
      line(childMinX, childMidY, childMaxX, childMidY);
    }
    
    children.forEach(c => {
      line(c.x + BOX_WIDTH/2, c.y, c.x + BOX_WIDTH/2, childMidY);
    });
    
    const childCenterX = (childMinX + childMaxX) / 2;
    line(parentCenterX, parentMidY, childCenterX, childMidY);
  });
}

function showProfileTooltip(person, e){
  let html = '<strong>'+person.name+'</strong><br>';
  html += person.images.map(i=>`<img src="${i}">`).join('');
  if(person.bio) html += person.bio;
  bioTooltip.innerHTML = html;
  bioTooltip.style.display='block';
}

function renderTree() {
  svg.innerHTML='';
  computePositions();
  drawLinks();
  people.forEach(p=>{
    const pos = positions[p.id];
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
    rect.setAttribute('x',pos.x + panX); rect.setAttribute('y',pos.y + panY);
    rect.setAttribute('width',BOX_WIDTH); rect.setAttribute('height',BOX_HEIGHT);
    rect.setAttribute('class','person-box '+p.gender);
    const text = document.createElementNS('http://www.w3.org/2000/svg','text');
    text.setAttribute('x',pos.x+BOX_WIDTH/2 + panX); text.setAttribute('y',pos.y+BOX_HEIGHT/2 + panY);
    text.setAttribute('class','person-text'); text.textContent=p.name;
    g.appendChild(rect); g.appendChild(text);
    g.addEventListener('click', () => {
      showProfile(p);
    });
    g.addEventListener('mouseenter',e=>{
      if(p.images.length || p.bio){
        showProfileTooltip(p, e);
      }
    });
    g.addEventListener('mouseleave',()=>{ bioTooltip.style.display='none'; });
    svg.appendChild(g);
  });
}

function updatePositions() {
  svg.innerHTML='';
  drawLinks();
  people.forEach(p=>{
    const pos = positions[p.id];
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
    rect.setAttribute('x',pos.x + panX); rect.setAttribute('y',pos.y + panY);
    rect.setAttribute('width',BOX_WIDTH); rect.setAttribute('height',BOX_HEIGHT);
    rect.setAttribute('class','person-box '+p.gender);
    const text = document.createElementNS('http://www.w3.org/2000/svg','text');
    text.setAttribute('x',pos.x+BOX_WIDTH/2 + panX); text.setAttribute('y',pos.y+BOX_HEIGHT/2 + panY);
    text.setAttribute('class','person-text'); text.textContent=p.name;
    g.appendChild(rect); g.appendChild(text);
    g.addEventListener('click', () => {
      showProfile(p);
    });
    g.addEventListener('mouseenter',e=>{
      if(p.images.length || p.bio){
        showProfileTooltip(p, e);
      }
    });
    g.addEventListener('mouseleave',()=>{ bioTooltip.style.display='none'; });
    svg.appendChild(g);
  });
}

svg.addEventListener('mousedown', (e) => {
  if(e.target === svg) {
    isPanning = true;
    panStartX = e.clientX - panX;
    panStartY = e.clientY - panY;
    svg.style.cursor = 'grabbing';
  }
});

svg.addEventListener('mousemove', (e) => {
  if(isPanning) {
    e.preventDefault();
    panX = e.clientX - panStartX;
    panY = e.clientY - panStartY;
    updatePositions();
  }
});

svg.addEventListener('mouseup', () => {
  isPanning = false;
  svg.style.cursor = 'grab';
});

document.addEventListener('mousemove', e => {
  if(bioTooltip.style.display === 'block') {
    bioTooltip.style.left = (e.clientX + 15) + 'px';
    bioTooltip.style.top = (e.clientY + 15) + 'px';
  }
});

window.onload = renderTree;
window.addEventListener('resize', renderTree);
</script>
</body>
</html>
